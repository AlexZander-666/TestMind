# Shannon PR模板集合

**用途：** 为不同类型的贡献提供标准化PR描述

---

## 🧪 模板1：测试贡献PR

### 适用场景
- 添加缺失的单元测试
- 提高测试覆盖率
- 无代码修改，仅添加测试

### PR标题格式

```
test: add unit tests for [module/file]
```

**示例：**
```
test: add unit tests for dashboard lib utilities
```

### PR描述模板

````markdown
## 📝 Description

This PR adds comprehensive unit tests for utility modules in the observability dashboard, specifically `format.ts` and `debug.ts`.

## 🎯 Motivation

These modules currently have no test coverage. Adding tests will:
- Prevent regressions when refactoring
- Document expected behavior
- Improve code quality confidence

## 📊 Coverage Improvement

| Module | Before | After | Improvement |
|--------|--------|-------|-------------|
| lib/format.ts | 0% | 95% | +95% |
| lib/debug.ts | 0% | 100% | +100% |
| **Total** | **0%** | **97%** | **+97%** |

## ✅ Test Quality Checklist

- [x] All tests pass locally (`pnpm test`)
- [x] No TypeScript errors (`pnpm typecheck`)
- [x] Follows project test conventions (vitest)
- [x] Covers normal flow and edge cases
- [x] Mocks are properly configured
- [x] Test assertions are accurate

## 📋 Test Details

### format.test.ts

**Test cases (7):**
1. ✅ Formats numbers < 1000 as integers
2. ✅ Formats thousands with 'k' suffix
3. ✅ Formats millions with 'M' suffix
4. ✅ Formats billions with 'B' suffix
5. ✅ Formats trillions with 'T' suffix
6. ✅ Handles tpsMode option correctly
7. ✅ Handles extraDecimalUnder100 option

**Coverage:** 95%  
**Execution time:** < 50ms

### debug.test.ts

**Test cases (3):**
1. ✅ Logs when DEBUG_LOGS is true
2. ✅ Skips logging when DEBUG_LOGS is false
3. ✅ Formats tag correctly

**Coverage:** 100%  
**Execution time:** < 10ms

## 🔧 Test Examples

<details>
<summary>format.test.ts (click to expand)</summary>

\`\`\`typescript
import { describe, it, expect } from 'vitest';
import { formatTokensAbbrev } from './format';

describe('formatTokensAbbrev', () => {
  it('should format numbers less than 1000', () => {
    expect(formatTokensAbbrev(0)).toBe('0');
    expect(formatTokensAbbrev(123)).toBe('123');
    expect(formatTokensAbbrev(999)).toBe('999');
  });

  it('should format thousands with k suffix', () => {
    expect(formatTokensAbbrev(1000)).toBe('1.0k');
    expect(formatTokensAbbrev(1500)).toBe('1.5k');
    expect(formatTokensAbbrev(999999)).toBe('1000.0k');
  });

  it('should format millions with M suffix', () => {
    expect(formatTokensAbbrev(1000000)).toBe('1.0M');
    expect(formatTokensAbbrev(1500000)).toBe('1.5M');
  });

  it('should handle tpsMode option', () => {
    expect(formatTokensAbbrev(123, { tpsMode: true })).toBe('123.0');
    expect(formatTokensAbbrev(1500, { tpsMode: true })).toBe('1.5k');
  });

  it('should handle extraDecimalUnder100 option', () => {
    expect(formatTokensAbbrev(50, { tpsMode: true, extraDecimalUnder100: true })).toBe('50.00');
    expect(formatTokensAbbrev(150, { tpsMode: true, extraDecimalUnder100: true })).toBe('150.0');
  });

  it('should handle negative numbers', () => {
    expect(formatTokensAbbrev(-1500)).toBe('-1.5k');
    expect(formatTokensAbbrev(-999)).toBe('-999');
  });

  it('should handle null and undefined', () => {
    expect(formatTokensAbbrev(null)).toBe('0');
    expect(formatTokensAbbrev(undefined)).toBe('0');
  });
});
\`\`\`

</details>

<details>
<summary>debug.test.ts (click to expand)</summary>

\`\`\`typescript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import { debugLog } from './debug';

describe('debugLog', () => {
  let consoleLogSpy: any;

  beforeEach(() => {
    consoleLogSpy = vi.spyOn(console, 'log').mockImplementation(() => {});
  });

  afterEach(() => {
    consoleLogSpy.mockRestore();
  });

  it('should log when DEBUG_LOGS is enabled', () => {
    // Assuming DEBUG_LOGS is true in test environment
    debugLog('test-tag', 'message', 'data');
    expect(consoleLogSpy).toHaveBeenCalledWith('[test-tag]', 'message', 'data');
  });

  it('should format tag correctly', () => {
    debugLog('myTag', 'info');
    expect(consoleLogSpy).toHaveBeenCalledWith('[myTag]', 'info');
  });

  it('should handle multiple arguments', () => {
    debugLog('tag', 'arg1', 'arg2', 123, { key: 'value' });
    expect(consoleLogSpy).toHaveBeenCalledWith(
      '[tag]',
      'arg1',
      'arg2',
      123,
      { key: 'value' }
    );
  });
});
\`\`\`

</details>

## 🤖 Generation & Review Process

1. Tests generated by TestMind AI
2. Manually reviewed for correctness
3. Locally validated (all pass)
4. Coverage verified
5. Code style adjusted to match project

## 📝 Checklist

- [x] Tests added for format.ts
- [x] Tests added for debug.ts
- [x] All tests pass locally
- [x] TypeScript compiles without errors
- [x] Coverage improved significantly
- [x] Follows project conventions
- [x] Commit messages are descriptive

Thank you for reviewing! I'm happy to make any adjustments based on your feedback.
````

---

## 🔧 模板2：修复+测试PR

### 适用场景
- 修复代码Bug
- 添加对应的测试

### PR标题格式

```
fix: [描述bug] + add tests
```

### PR描述模板

````markdown
## 🐛 Bug Description

[描述发现的bug]

## 🔍 Root Cause

[分析根本原因]

## ✅ Fix

[描述修复方案]

## 🧪 Tests Added

[描述添加的测试]

## 📊 Verification

- [x] Bug reproduced with failing test
- [x] Fix applied
- [x] All tests now pass
- [x] No regressions

````

---

## 📚 模板3：文档贡献PR

### 适用场景
- 添加JSDoc注释
- 改进README
- 添加使用示例

### PR标题格式

```
docs: improve documentation for [module]
```

---

## 💡 PR写作最佳实践

### 标题要素

1. **类型前缀**
   - `test:` - 测试相关
   - `fix:` - Bug修复
   - `feat:` - 新功能
   - `docs:` - 文档
   - `refactor:` - 重构

2. **简洁描述**
   - 50字符以内
   - 动词开头
   - 小写字母

### 描述要素

1. **清晰的目标**
   - 为什么需要这个PR？
   - 解决什么问题？

2. **具体的改进**
   - 数据支持（覆盖率、性能等）
   - 示例代码

3. **完整的验证**
   - 本地测试结果
   - CI状态

4. **友好的态度**
   - 感谢reviewers
   - 愿意修改

---

## 🎯 PR审查预期

### Shannon项目可能的反馈

**常见建议：**
1. "测试命名需要更具体"
2. "Mock策略需要调整"
3. "可以添加更多边界情况"
4. "需要follow项目的断言风格"

**应对策略：**
- ✅ 虚心接受
- ✅ 快速响应
- ✅ 认真修改
- ✅ 学习提升

### 合并后

**记得：**
1. 更新fork的main分支
2. 删除已合并的特性分支
3. 在SHANNON_FEEDBACK.md记录成功经验
4. 继续下一个贡献

---

## 📞 需要帮助？

### TestMind问题

- GitHub Issues: github.com/yourusername/testmind/issues
- 查看：TESTMIND_ISSUES_LOG.md

### Shannon问题

- Shannon Discord: （见Shannon README）
- Shannon Issues: github.com/Kocoro-lab/Shannon/issues

---

**祝贡献成功！** 🎉

记住：每一个被合并的PR都是对开源社区的宝贵贡献。












