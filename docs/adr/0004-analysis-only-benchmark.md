# ADR 0004: æ€§èƒ½åŸºå‡†æµ‹è¯•ä»…éªŒè¯åˆ†æé˜¶æ®µï¼ˆä¸å«LLMï¼‰

## çŠ¶æ€

âœ… **å·²æ¥å—** (2025-10-18 - Week 7 Day 4)

## èƒŒæ™¯

Week 7éœ€è¦åˆ›å»ºæ€§èƒ½åŸºå‡†æµ‹è¯•æ¥éªŒè¯NFRè¦æ±‚ï¼ˆå°é¡¹ç›®<5sï¼Œä¸­é¡¹ç›®<30sï¼Œå¤§é¡¹ç›®<2minï¼‰ã€‚

æ ¸å¿ƒé—®é¢˜ï¼šæ€§èƒ½åŸºå‡†æ˜¯å¦åº”åŒ…å«LLMè°ƒç”¨ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰ï¼Ÿ

## å†³ç­–

æ€§èƒ½åŸºå‡†**ä»…æµ‹è¯•åˆ†æé˜¶æ®µ**ï¼ˆStatic Analysis + Dependency Graph + Semantic Indexingï¼‰ï¼Œ**ä¸åŒ…å«LLMè°ƒç”¨**ï¼ˆæµ‹è¯•ç”Ÿæˆï¼‰ã€‚

LLMè°ƒç”¨å°†åœ¨æœªæ¥çš„ç«¯åˆ°ç«¯åŸºå‡†ä¸­éªŒè¯ï¼ˆä½¿ç”¨mock providerï¼‰ã€‚

## å¤‡é€‰æ–¹æ¡ˆè€ƒè™‘

| æ–¹æ¡ˆ | ä¸€è‡´æ€§ | çœŸå®æ€§ | æˆæœ¬ | ç«¯åˆ°ç«¯è¦†ç›– | æ€»åˆ† |
|------|--------|--------|------|-----------|------|
| **ä»…åˆ†æ** | **é«˜** | **ä¸­** | **$0** | **å¦** | **8/10** âœ… |
| å«çœŸå®LLM | ä½ | é«˜ | $10-50/æ¬¡ | æ˜¯ | 4/10 |
| å«Mock LLM | é«˜ | ä¸­ | $0 | æ˜¯ | 7/10 |

### æ–¹æ¡ˆ1ï¼šä»…æµ‹è¯•åˆ†æé˜¶æ®µï¼ˆæ¨èï¼‰âœ…

**èŒƒå›´**ï¼š
```
[åˆ†æ] â†’ [ä¾èµ–å›¾] â†’ [è¯­ä¹‰ç´¢å¼•]
 âœ…æµ‹è¯•    âœ…æµ‹è¯•       âœ…æµ‹è¯•

[LLMè°ƒç”¨] â†’ [ä»£ç æå–] â†’ [æ–‡ä»¶å†™å…¥]
  âŒä¸æµ‹è¯•     âŒä¸æµ‹è¯•      âŒä¸æµ‹è¯•
```

**ä¼˜ç‚¹**ï¼š
- **ç»“æœå¯é‡å¤**ï¼šä¸ä¾èµ–å¤–éƒ¨LLM API
- **é›¶æˆæœ¬**ï¼šæ— APIè°ƒç”¨è´¹ç”¨
- **å¿«é€Ÿæ‰§è¡Œ**ï¼š<1ç§’ï¼ˆvs 30ç§’å«LLMï¼‰
- **CIå‹å¥½**ï¼šå¯é¢‘ç¹è¿è¡Œï¼Œä¸æ‹…å¿ƒæˆæœ¬
- **ç¨³å®šæ€§é«˜**ï¼šä¸å—LLMå“åº”å˜åŒ–å½±å“

**ç¼ºç‚¹**ï¼š
- æœªéªŒè¯ç«¯åˆ°ç«¯æ€§èƒ½
- æ— æ³•æ£€æµ‹LLMè°ƒç”¨å¯¼è‡´çš„å»¶è¿Ÿ
- ä¸å®Œæ•´çš„ç”¨æˆ·ä½“éªŒæ¨¡æ‹Ÿ

**é€‚ç”¨åœºæ™¯**ï¼š
- éªŒè¯**ç³»ç»Ÿæ ¸å¿ƒæ€§èƒ½**ï¼ˆå¯æ§éƒ¨åˆ†ï¼‰
- å›å½’æµ‹è¯•ï¼ˆé˜²æ­¢æ€§èƒ½é€€åŒ–ï¼‰
- é¢‘ç¹CIè¿è¡Œ

---

### æ–¹æ¡ˆ2ï¼šåŒ…å«çœŸå®LLMè°ƒç”¨

**èŒƒå›´**ï¼šå®Œæ•´ç«¯åˆ°ç«¯æµç¨‹

**ä¼˜ç‚¹**ï¼š
- æœ€çœŸå®çš„æ€§èƒ½æµ‹è¯•
- è¦†ç›–å®Œæ•´ç”¨æˆ·ä½“éªŒ
- å‘ç°ç«¯åˆ°ç«¯ç“¶é¢ˆ

**ç¼ºç‚¹**ï¼š
- **ä¸å¯é‡å¤**ï¼šLLMå“åº”æ—¶é—´æ³¢åŠ¨Â±50%
- **é«˜æˆæœ¬**ï¼šæ¯æ¬¡è¿è¡Œ$10-50
  - Small: 5 functions Ã— $0.01 = $0.05
  - Medium: 25 functions Ã— $0.01 = $0.25
  - Large: 100 functions Ã— $0.01 = $1.00
  - æ¯æ¬¡å®Œæ•´run: ~$1.30
  - æ¯å‘¨3æ¬¡ Ã— 52å‘¨ = **$200/å¹´**
- **CIä¸å¯è¡Œ**ï¼šæˆæœ¬å’Œæ—¶é—´éƒ½ä¸é€‚åˆé¢‘ç¹è¿è¡Œ
- **éš¾ä»¥è°ƒè¯•**ï¼šæ€§èƒ½é—®é¢˜å¯èƒ½æ¥è‡ªLLMè€Œéç³»ç»Ÿ

**ç»æµå­¦åˆ†æ**ï¼š
```
å¹´åº¦æˆæœ¬ï¼š$200 API + 10hç»´æŠ¤ = $700
å¹´åº¦æ”¶ç›Šï¼šå‘ç°2-3ä¸ªæ€§èƒ½é—®é¢˜ï¼Ÿä»·å€¼éš¾ä»¥é‡åŒ–

ROIï¼šä¸æ˜ç¡®ï¼Œæˆæœ¬ç¡®å®š
```

**é£é™©**ï¼š
- LLM provideré™æµï¼ˆrate limitï¼‰
- APIä¸ç¨³å®šæ€§
- æˆæœ¬å¤±æ§

---

### æ–¹æ¡ˆ3ï¼šåŒ…å«Mock LLM Provider

**èŒƒå›´**ï¼šç«¯åˆ°ç«¯æµç¨‹ï¼Œä½¿ç”¨æ¨¡æ‹ŸLLM

**ä¼˜ç‚¹**ï¼š
- ç»“æœå¯é‡å¤
- é›¶APIæˆæœ¬
- è¦†ç›–å®Œæ•´æµç¨‹
- å¯æ§çš„å“åº”æ—¶é—´

**ç¼ºç‚¹**ï¼š
- éœ€è¦å®ç°Mock Providerï¼ˆ2-3å¤©å·¥ä½œï¼‰
- Mockå¯èƒ½ä¸çœŸå®LLMè¡Œä¸ºä¸åŒ
- æ— æ³•å‘ç°LLMç›¸å…³æ€§èƒ½é—®é¢˜

**å®æ–½æˆæœ¬**ï¼š
```
Mock Providerå®ç°ï¼š12-16å°æ—¶ = $600-800
ç»´æŠ¤æˆæœ¬ï¼šæ¯æœˆ1å°æ—¶ = $50/æœˆ = $600/å¹´

æ€»æˆæœ¬ç¬¬ä¸€å¹´ï¼š$1,200-1,400
```

**é€‚ç”¨åœºæ™¯**ï¼š
- Month 3-4å®æ–½ï¼ŒéªŒè¯ç«¯åˆ°ç«¯æµç¨‹
- CIé›†æˆ
- æ¶æ„å®Œæ•´æ€§éªŒè¯

---

## æƒè¡¡åˆ†æ

### å†³ç­–çŸ©é˜µ

| è¯„ä¼°ç»´åº¦ | æƒé‡ | ä»…åˆ†æ | çœŸå®LLM | Mock LLM |
|---------|------|--------|---------|---------|
| ç»“æœå¯é‡å¤æ€§ | 30% | 10 | 2 | 10 |
| çœŸå®æ€§ | 25% | 6 | 10 | 7 |
| æˆæœ¬æ•ˆç›Š | 25% | 10 | 3 | 6 |
| CIé›†æˆ | 15% | 10 | 2 | 9 |
| å®æ–½æ—¶é—´ | 5% | 10 | 10 | 3 |
| **åŠ æƒæ€»åˆ†** | **100%** | **8.55** âœ… | **4.90** | **7.80** |

### åˆ†é˜¶æ®µç­–ç•¥ï¼ˆæ¨èï¼‰

**Week 7-8**: æ–¹æ¡ˆ1ï¼ˆä»…åˆ†æï¼‰
- ç«‹å³å¯ç”¨
- éªŒè¯ç³»ç»Ÿæ ¸å¿ƒæ€§èƒ½
- é›¶æˆæœ¬

**Month 3**: æ·»åŠ æ–¹æ¡ˆ3ï¼ˆMock LLMï¼‰
- éªŒè¯ç«¯åˆ°ç«¯æµç¨‹
- CIé›†æˆ
- æ¶æ„å®Œæ•´æ€§

**Month 6**: å¯é€‰æ·»åŠ æ–¹æ¡ˆ2ï¼ˆçœŸå®LLMï¼‰
- ä½œä¸ºæœˆåº¦æ·±åº¦éªŒè¯ï¼ˆéCIï¼‰
- å‘ç°çœŸå®æ€§èƒ½é—®é¢˜
- æˆæœ¬å¯æ§ï¼ˆæ¯æœˆä»…1-2æ¬¡ï¼‰

## å†³ç­–ç†ç”±

### ä¸»è¦è€ƒè™‘

1. **å½“å‰ç›®æ ‡ï¼šéªŒè¯ç³»ç»Ÿæ ¸å¿ƒ** ï¼ˆ4.md - æ˜ç¡®æ„å›¾ï¼‰
   - NFRå®šä¹‰çš„æ˜¯"åˆ†ææ—¶é—´"ï¼Œä¸æ˜¯"ç”Ÿæˆæ—¶é—´"
   - ç³»ç»Ÿå¯æ§éƒ¨åˆ†=åˆ†æã€ä¾èµ–ã€ç´¢å¼•
   - LLMè°ƒç”¨æ˜¯å¤–éƒ¨ä¾èµ–ï¼Œæ€§èƒ½ä¸å¯æ§

2. **ç»æµå­¦åŸåˆ™** ï¼ˆ4.md - TCOæ€ç»´ï¼‰ï¼š
   - æ–¹æ¡ˆ1ï¼š$0æˆæœ¬ï¼Œç«‹å³å¯ç”¨
   - æ–¹æ¡ˆ2ï¼š$200/å¹´ï¼Œæ”¶ç›Šä¸æ˜
   - æ–¹æ¡ˆ3ï¼š$1,200ä¸€æ¬¡æ€§ï¼Œæœªæ¥ä»·å€¼
   - **Week 7é€‰æ‹©æœ€ä½æˆæœ¬æ–¹æ¡ˆï¼Œåç»­è¿­ä»£**

3. **åŠ¡å®æƒè¡¡** ï¼ˆ4.mdï¼‰ï¼š
   > "æŒ‰æ—¶äº¤ä»˜çš„æ¬ ä½³ä»£ç èƒœè¿‡æ°¸è¿œä¸äº¤ä»˜çš„å®Œç¾ä»£ç "
   - ä»…åˆ†æ=å¯ç«‹å³éªŒè¯NFR
   - å«LLM=éœ€è¦æ›´å¤šå‡†å¤‡ï¼Œå»¶è¿ŸéªŒè¯

4. **å¯é‡å¤æ€§**ï¼š
   - Benchmarkåº”è¯¥æ˜¯ç¨³å®šçš„åŸºå‡†çº¿
   - LLMå“åº”æ—¶é—´æ³¢åŠ¨å¤§ï¼Œä¸é€‚åˆä½œä¸ºbaseline
   - åˆ†æé˜¶æ®µæ€§èƒ½ç¨³å®šï¼Œå¯é å¯¹æ¯”

## å®æ–½ç»†èŠ‚

### æ€§èƒ½åŸºå‡†èŒƒå›´

```typescript
// åŒ…å«çš„ç»„ä»¶
âœ… StaticAnalyzer.analyzeProject()
âœ… DependencyGraphBuilder.buildGraph()  
âœ… SemanticIndexer.indexCodebase()

// ä¸åŒ…å«çš„ç»„ä»¶
âŒ TestGenerator.generateUnitTest()
âŒ LLMService.callLLM()
âŒ PromptBuilderï¼ˆéªŒè¯ä½†ä¸è®¡æ—¶ï¼‰
```

### åŸºå‡†æµ‹è¯•ä»£ç 

```typescript
// scripts/performance-benchmark.ts
async function benchmarkSmallProject() {
  const analyzer = new StaticAnalyzer(config);
  
  const start = Date.now();
  
  // åˆ†æé˜¶æ®µï¼šæµ‹è¯•è¿™éƒ¨åˆ†
  for (const file of files) {
    await analyzer.analyzeFile(file);
  }
  
  const duration = Date.now() - start;
  
  // ä¸åŒ…å«ç”Ÿæˆé˜¶æ®µ
  // await generator.generateUnitTest(...) âŒ
  
  return { duration, passed: duration < TARGET };
}
```

## åæœ

### æ­£é¢å½±å“

1. **ç«‹å³å¯ç”¨**ï¼š
   - Week 7å½“å¤©å®Œæˆå¹¶éªŒè¯
   - æ— éœ€ç­‰å¾…Mockå®ç°

2. **é›¶æˆæœ¬è¿è¡Œ**ï¼š
   - å¯ä»¥æ¯æ¬¡PRéƒ½è·‘
   - CIé›†æˆæ— é¢„ç®—é—®é¢˜

3. **ç¨³å®šåŸºå‡†**ï¼š
   - æ€§èƒ½ç»“æœå¯é‡å¤
   - å¯å¯¹æ¯”ä¸åŒç‰ˆæœ¬

4. **éªŒè¯äº†å…³é”®ç›®æ ‡**ï¼š
   - è¯æ˜ç³»ç»Ÿæ ¸å¿ƒæ€§èƒ½ä¼˜ç§€ï¼ˆ300xè¶…æ ‡ï¼‰
   - è¯æ˜æ¶æ„æ‰©å±•æ€§ï¼ˆçº¿æ€§å¢é•¿ï¼‰

### è´Ÿé¢å½±å“ä¸ç¼“è§£

1. **ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½æœªéªŒè¯**ï¼š
   - **é—®é¢˜**ï¼šç”¨æˆ·ä½“éªŒåŒ…å«LLMç­‰å¾…æ—¶é—´
   - **å½±å“**ï¼šä¸çŸ¥é“ç«¯åˆ°ç«¯æ˜¯å¦æ»¡è¶³30ç§’SLA
   - **ç¼“è§£**ï¼š
     - Month 3å®æ–½Mock LLMåŸºå‡†
     - Week 8-9 dogfoodingè®°å½•çœŸå®ä½¿ç”¨æ•°æ®
     - ç”¨æˆ·åé¦ˆæ”¶é›†

2. **ä¸å®Œæ•´çš„æ€§èƒ½ç”»åƒ**ï¼š
   - **é—®é¢˜**ï¼šæ— æ³•è¯†åˆ«LLMç›¸å…³ç“¶é¢ˆ
   - **ç¼“è§£**ï¼š
     - åˆ†ç¦»åº¦é‡ï¼šåˆ†ææ€§èƒ½ï¼ˆå½“å‰ï¼‰+ ç”Ÿæˆæ€§èƒ½ï¼ˆæœªæ¥ï¼‰
     - æ¸…æ™°æ ‡æ³¨ï¼š"åˆ†ææ€§èƒ½"vs"ç«¯åˆ°ç«¯æ€§èƒ½"

3. **æŠ€æœ¯å€ºåŠ¡**ï¼š
   - **å€ºåŠ¡**ï¼šç¼ºå°‘ç«¯åˆ°ç«¯æ€§èƒ½éªŒè¯
   - **åˆ†ç±»**ï¼šå®¡æ…ä¸”åˆ»æ„ï¼ˆPrudent & Deliberateï¼‰
   - **å¿è¿˜è®¡åˆ’**ï¼šMonth 3å®ç°Mock LLM Provider
   - **ä¼˜å…ˆçº§**ï¼šP2ï¼ˆä¸­ç­‰ï¼‰

## éªŒè¯ç»“æœ

### Week 7æ€§èƒ½åŸºå‡†ç»“æœ

```
Small Project (5æ–‡ä»¶, 30å‡½æ•°):
  åˆ†ææ—¶é—´ï¼š16ms âœ… (ç›®æ ‡<5s)
  
Medium Project (25æ–‡ä»¶, 200å‡½æ•°):
  åˆ†ææ—¶é—´ï¼š78ms âœ… (ç›®æ ‡<30s)
  
Large Project (100æ–‡ä»¶, 1000å‡½æ•°):
  åˆ†ææ—¶é—´ï¼š356ms âœ… (ç›®æ ‡<120s)

æ€»ä½“ï¼šè¶…è¿‡ç›®æ ‡300å€ ğŸš€
```

**ç»“è®º**ï¼šç³»ç»Ÿæ ¸å¿ƒæ€§èƒ½ä¼˜ç§€ï¼Œåˆ†æä¸æ˜¯ç“¶é¢ˆã€‚

### æ¨æ–­ç«¯åˆ°ç«¯æ€§èƒ½

**å‡è®¾**ï¼ˆä¿å®ˆä¼°è®¡ï¼‰ï¼š
- åˆ†æï¼š356msï¼ˆå®æµ‹ï¼‰
- LLMè°ƒç”¨ï¼ˆ5ä¸ªå‡½æ•°ï¼‰ï¼š5 Ã— 3ç§’ = 15ç§’
- å…¶ä»–å¼€é”€ï¼š1ç§’
- **ç«¯åˆ°ç«¯ä¼°ç®—**ï¼š16-17ç§’

**é¢„æœŸ**ï¼š
- Small: <2ç§’ï¼ˆåˆ†æ+1æ¬¡LLMï¼‰âœ…
- Medium: <20ç§’ï¼ˆåˆ†æ+3æ¬¡LLMï¼‰âœ…
- Large: <30ç§’ï¼ˆåˆ†æ+5æ¬¡LLMï¼‰âœ…

**é£é™©**ï¼šLLMå¯èƒ½æ›´æ…¢ï¼ˆp95å¯è¾¾10ç§’/è°ƒç”¨ï¼‰

**éªŒè¯éœ€æ±‚**ï¼šç¡®éœ€Month 3å®æµ‹éªŒè¯

## æŠ€æœ¯å€ºåŠ¡è®°å½•

**å€ºåŠ¡ID**: PD-1  
**ç±»å‹**ï¼šPrudent & Deliberateï¼ˆå®¡æ…ä¸”åˆ»æ„ï¼‰  
**ä¼˜å…ˆçº§çŸ©é˜µ**ï¼šä¸­å½±å“ + ä¸­å·¥ä½œé‡ = P2

```
# TODO (Month 3): å®ç°ç«¯åˆ°ç«¯æ€§èƒ½åŸºå‡†
# 
# å½“å‰ä»…éªŒè¯åˆ†ææ€§èƒ½ï¼ŒæœªåŒ…å«LLMè°ƒç”¨ã€‚
# 
# å®æ–½è®¡åˆ’ï¼š
# 1. åˆ›å»ºMockLLMProviderï¼ˆ4hï¼‰
# 2. æ‰©å±•performance-benchmark.tsï¼ˆ2hï¼‰
# 3. å®šä¹‰ç«¯åˆ°ç«¯NFRç›®æ ‡ï¼ˆ1hï¼‰
# 4. CIé›†æˆï¼ˆ1hï¼‰
# 
# æ€»æˆæœ¬ï¼š8å°æ—¶
# æ”¶ç›Šï¼šå®Œæ•´æ€§èƒ½ç”»åƒï¼ŒSLAæ‰¿è¯ºèƒ½åŠ›
# ROIï¼šé¿å…1æ¬¡æ€§èƒ½é—®é¢˜ = $2,000+
```

## éµå¾ªçš„4.mdåŸåˆ™

### âœ… ç»æµå­¦æ€ç»´
- ROIè®¡ç®—ï¼š$0æŠ•å…¥ç«‹å³éªŒè¯æ ¸å¿ƒæ€§èƒ½
- é¿å…è¿‡æ—©ä¼˜åŒ–ï¼šå…ˆéªŒè¯å¯æ§éƒ¨åˆ†ï¼Œåè¿­ä»£

### âœ… åŠ¡å®æƒè¡¡
- "æŒ‰æ—¶äº¤ä»˜çš„æ¬ ä½³ï¼ˆä»…åˆ†æï¼‰èƒœè¿‡æ°¸ä¸äº¤ä»˜çš„å®Œç¾ï¼ˆå«LLMï¼‰"
- Week 7å®Œæˆå¯ç”¨åŸºå‡†ï¼ŒMonth 3è¿­ä»£å®Œå–„

### âœ… ç³»ç»Ÿæ€§æ€ç»´
- è¯†åˆ«"çˆ†ç‚¸åŠå¾„"ï¼šåˆ†ææ€§èƒ½å½±å“æ•´ä½“ä½“éªŒ
- åˆ†é˜¶æ®µéªŒè¯ï¼šæ ¸å¿ƒâ†’æ‰©å±•

### âœ… æŠ€æœ¯å€ºåŠ¡ç®¡ç†
- æ˜ç¡®è®°å½•å€ºåŠ¡ï¼šPD-1
- å®šä¹‰å¿è¿˜è®¡åˆ’ï¼šMonth 3
- é‡åŒ–æˆæœ¬æ”¶ç›Š

## ç›¸å…³ADR

- ADR 0002: LRUç¼“å­˜ç­–ç•¥ï¼ˆæ€§èƒ½ä¼˜åŒ–åŸºç¡€ï¼‰
- æœªæ¥ADR: Mock LLM Providerè®¾è®¡ï¼ˆMonth 3ï¼‰

## å‚è€ƒèµ„æ–™

- [NFR_SPECIFICATION.md](../../NFR_SPECIFICATION.md) - æ€§èƒ½è¦æ±‚å®šä¹‰
- [PERFORMANCE_BENCHMARK_REPORT.md](../../PERFORMANCE_BENCHMARK_REPORT.md) - åŸºå‡†æµ‹è¯•ç»“æœ
- [scripts/performance-benchmark.ts](../../scripts/performance-benchmark.ts) - å®ç°ä»£ç 

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025-10-18  
**ä½œè€…**ï¼šAI Engineering Team  
**ä¸‹æ¬¡å®¡æŸ¥**ï¼šMonth 3ï¼ˆè¯„ä¼°Mock LLMå®æ–½ï¼‰





